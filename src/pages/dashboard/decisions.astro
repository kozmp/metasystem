---
/**
 * @fileoverview Dashboard - Symulator Sterowania
 * @cybernetic Modu Decyzyjny - Analiza wpywu i rekomendacje
 * 
 * Zgodnie z teori Kosseckiego:
 * System analizuje graf relacji i doradzai jak najlepiej wpyn na wybrany obiekt
 */

import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase/client';

// Pobierz list obiekt贸w do wyboru
let objects: Array<{ id: string; name: string }> = [];

try {
  const { data } = await supabase
    .from('cybernetic_objects')
    .select('id, name')
    .order('name');
  
  objects = data || [];
} catch (error) {
  console.error('[DECISIONS] Bd pobierania obiekt贸w:', error);
}
---

<Layout 
  title="Symulator Sterowania - KOSSECKI METASYSTEM"
  description="Modu Decyzyjny - Analiza wpywu i rekomendacje sterownicze"
>
  <main class="min-h-screen p-6">
    <!-- Kontener dla React Component -->
    <div id="decision-simulator" data-objects={JSON.stringify(objects)}></div>
    
    <!-- Instrukcja u偶ytkowania -->
    <section class="card-terminal p-6 mt-6">
      <h2 class="text-xl font-bold text-terminal-accent uppercase tracking-wider mb-4">
        [INSTRUKCJA] Jak korzysta z Symulatora Sterowania
      </h2>
      
      <div class="space-y-4 text-sm text-terminal-text">
        <div>
          <h3 class="font-bold text-terminal-accent mb-2">1. Wybierz obiekt docelowy</h3>
          <p class="text-terminal-muted">
            Wybierz obiekt z listy rozwijanej lub kliknij na wze w grafie relacji.
            To jest obiekt, kt贸ry chcesz wzmocni lub osabi.
          </p>
        </div>
        
        <div>
          <h3 class="font-bold text-terminal-accent mb-2">2. Wybierz cel sterowania</h3>
          <p class="text-terminal-muted">
            <strong>WZMOCNI</strong> - Zwikszy wpyw obiektu w systemie<br />
            <strong>OSABI</strong> - Zmniejszy wpyw obiektu w systemie
          </p>
        </div>
        
        <div>
          <h3 class="font-bold text-terminal-accent mb-2">3. Uruchom symulacj</h3>
          <p class="text-terminal-muted">
            System przeanalizuje graf relacji u偶ywajc algorytmu BFS i znajdzie wszystkie cie偶ki wpywu
            prowadzce do wybranego obiektu. Nastpnie obliczy d藕wigni sterownicz dla ka偶dego wza.
          </p>
        </div>
        
        <div>
          <h3 class="font-bold text-terminal-accent mb-2">4. Przeczytaj rekomendacje</h3>
          <p class="text-terminal-muted">
            System wywietli g贸wn rekomendacj (najwy偶sza d藕wignia sterownicza) oraz alternatywne opcje.
            Ka偶da rekomendacja zawiera:
          </p>
          <ul class="list-disc list-inside ml-4 mt-2 text-terminal-muted space-y-1">
            <li><strong>Akcj</strong> - CO zrobi (kt贸ry obiekt wzmocni/osabi)</li>
            <li><strong>Uzasadnienie</strong> - DLACZEGO (parametry cybernetyczne)</li>
            <li><strong>Oczekiwany wpyw</strong> - Sia wpywu (0-100%)</li>
            <li><strong>Pewno</strong> - Rzetelno relacji (0-100%)</li>
          </ul>
        </div>
        
        <div>
          <h3 class="font-bold text-terminal-accent mb-2">5. Wygeneruj strategi AI (opcjonalnie)</h3>
          <p class="text-terminal-muted">
            Kliknij [GENERUJ STRATEGI AI] aby otrzyma szczeg贸ow strategi sterowania
            wygenerowan przez AI zgodnie z teori Kosseckiego. Strategia uwzgldnia:
          </p>
          <ul class="list-disc list-inside ml-4 mt-2 text-terminal-muted space-y-1">
            <li>Bilans mocy swobodnej (available_power)</li>
            <li>Sprz偶enia zwrotne (positive/negative feedback)</li>
            <li>Rzetelno relacji (certainty_score)</li>
            <li>D藕wigni sterownicz (leverage = power  influence  certainty)</li>
          </ul>
        </div>
        
        <div class="card-terminal p-4 border-2 border-control-cognitive bg-control-cognitive/10">
          <h3 class="font-bold text-control-cognitive mb-2 uppercase">
             Teoria Kosseckiego
          </h3>
          <p class="text-sm text-terminal-muted">
            <strong>D藕wignia Sterownicza (Control Leverage)</strong> to kluczowy parametr w teorii Kosseckiego.
            Okrela jak skutecznie mo偶esz wpyn na dany obiekt poprzez porednie sterowanie innym obiektem.
          </p>
          <p class="text-sm text-terminal-muted mt-2">
            <code>Leverage = Available_Power  Influence_Strength  Certainty_Score</code>
          </p>
          <p class="text-sm text-terminal-muted mt-2">
            Im wy偶sza d藕wignia, tym bardziej efektywne sterowanie. Uwzgldnia ona zar贸wno mo偶liwoci obiektu (moc),
            jak i jako informacji o relacji (rzetelno).
          </p>
        </div>
      </div>
    </section>
    
    <!-- Footer -->
    <footer class="card-terminal p-4 mt-6 text-center">
      <div class="flex justify-center gap-4">
        <a 
          href="/dashboard" 
          class="px-4 py-2 bg-terminal-accent text-terminal-bg font-bold uppercase tracking-wider hover:bg-terminal-accent/80"
        >
          [POWRT DO DASHBOARD]
        </a>
        <a 
          href="/dashboard/recon" 
          class="px-4 py-2 bg-control-cognitive text-white font-bold uppercase tracking-wider hover:bg-control-cognitive/80"
        >
          [CENTRUM ZWIADU]
        </a>
      </div>
      
      <p class="mt-4 text-xs text-terminal-muted">
        Modu Decyzyjny v1.0 | Teoria: doc. J贸zef Kossecki "Metacybernetyka"
      </p>
    </footer>
  </main>
</Layout>

<script>
  /**
   * @cybernetic Client-side hydration dla DecisionSimulator
   */
  import { createRoot } from 'react-dom/client';
  import { createElement } from 'react';
  import { DecisionSimulator } from '../../components/cybernetics/DecisionSimulator';

  // Hydrate DecisionSimulator
  const simulatorContainer = document.getElementById('decision-simulator');
  if (simulatorContainer) {
    const root = createRoot(simulatorContainer);
    root.render(createElement(DecisionSimulator, {}));
  }
</script>

